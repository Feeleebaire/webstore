Changelog

Please see https://github.com/lightspeedretail/webstore/issues for technical details of these issues

# 2.2.0

New Features
* New "Brooklyn" template with light and dark selectable themes
* SEO Options and 3rd party integration
* Inventory handling
* Promo Code revamp
* Checkout, refactored checkout page into widgets to avoid errors
* Paypal Pro module
* Admin troubleshooting tasks
* Many options for enabling/disabling WS features, adjusting features in Admin panel (instead of manually)

General
* Web Store now tracks available inventory, deducting pending orders to prevent backordering (requires uploading Orders from LightSpeed)
* Improved code to eliminate Cross-Site (XSS) Scripting errors flagged by some scanners
* Product URLs now generated from product descriptions to greatly improve site SEO
* SEO-Friendly URLs now generated by default, Admin panel option has been removed. New .htaccess file required.
* Created URL forwarding mechanism so old Web Store URLs will properly forward to new format without damaging search ranking
* Implemented Google Analytics natively, add UA account code to Admin Panel
* Implemented Google AdWords conversion code, add account code to Admin Panel
* Created log entry expiration, ability to eliminate System Log entries after set number of days (default 30)
* Now properly restores abandoned cart for logged in user on next login to resume prior shopping session
* Page Titles, Meta Descriptions now configurable through Admin Panel, can use different macro keywords


Templates
* Booklyn template scalable and fully functional with iPad, iPhone and other smartphones
* Tabs are now editable through Admin Panel custom pages instead of modifying templates manually
* Custom Pages can be enabled/disabled and will add/remove tabs automatically
* Modified default banner size to more standard 750x100 instead of 748x111
* Web Store detects iPad/iPhone browsing and changes hover products to clickable dropdown of Primary categories
* Subcategories now show as links below primary header
* Web Store properly handles Login on iPad
* Added option to specify featured products for home page
* Added option to Display/Hide Product Code on Product Details page
* Added option to Display/Hide Original prices as slashed out on details and grid
* Added option to handle displaying matrix price ranges on grid if child products have different prices
* Added additional sorting options for products including Short Description, Keywords, and Last Modified
* Show Empty Categories now showing empty for all levels, not just primary category level

Third-Party Integration
* Created XML Feeds for Google Merchant (i.e. Google Base/Google Shopping)
* Created feed structure to easily allow additional XML files to be created easily
* Created dynamic Sitemap.XML using feed mechanism, added to robots.txt
* Added option to Display/Hide Facebook/Pinterest, other Sharing buttons (sharing.tpl.php)
* Google Merchant categories now available to match to Web Store categories

Image Handling
* Graphic display now uses proper IMG tags to allow third-party sites to index photos (Google Images, Pinterest, Amazon Wish, etc)
* Product images now named with product description instead of code numbers for better SEO
* Product images now in folder hierarchy, rather than all photos in a single /photos folder
* Created separate image dimensions for Slider, Cart Thumbnail, Preview Icon to control image size independently

Uploader
* Uploading categories are now cached properly and detect changes, eliminating the Cache Categories Admin panel option
* Fixed an issue where renaming a Tax Code would cause an Uploader error, avoids Store Reset
* Fixed an issue where an SRO with a decimal qty (i.e. 3.45) would cause an upload failure


Installer
* Installer now checks check for OpenSSL Extension
* Installer skips magic_quotes_gpc check for PHP 5.4 since this option no longer exists
* Installer detects existing database, will recreate configuration.inc.php without overwriting
* Database upgrade tracks migration status, will not migrate more than once
* Installer hardcoded as UTF8 to avoid foreign character issues


Payments
* Created PayPal Payments Pro module
* Expanded Promo Codes to apply based on various criteria such as family, class, keywords, or invidual products
* Corrected a problem where a discount amount and a minimum cart value could conflict
* Admin panel displays notification when module has been turned on but not configured
* Admin panel displays notification when module is in test mode to avoid lost charges
* Properly send CVV to Authorize.net when enabled in Admin Panel as well as Authorize.Net account
* Beanstream now receives customer shipping information for use on their receipts


Checkout
* Simplified internal checkout workflow to eliminate order errors
* Replaced custom captcha widget with Google ReCaptcha
* Created options to turn off Captcha under different circumstances (none/logged in users/all)
* Properly detect if item in cart has become unavailable due to another customer checkout, removes from cart and alerts user
* Created option to allow user to create an account on checkout by providing password, instead of registering separately
* Introduced second email entry blank to retype email (for non-logged in users) to avoid typos in email
* Fixed an issue where checkout Notes would be truncated due to error in field definition, now handles large text blocks
* Credit Card declines show actual decline reason instead of always "Payment Failure"
* Added option to force shipping/billing to be same address
* Fixed general formatting issues with required field labelling

Email
* Added cart information to email receipts to show cart contents
* Created SMTP option for AUTH PLAIN for certain email servers that require it
* Eliminated extra Email Address field, Web Store uses Store Email address under Store Configuration


Shipping
* Corrected the country Russian Federation to Russia in shipping modules
* Shipping Destination setup now allows default Tax for any location not otherwise defined, avoids having to define every country
* Provided mechanism for offering free shipping through promo code, defining further restrictions
* Added additional UPS options to better control rates being received from iUPS module when using an account


Admin Panel
* General cleanup and clarification of option labels, rearranging of options into more logical menu format
* Added hints and guidelines throughout Admin Panel to assist users with configuration
* Shipping and Payment modules can now be turned off without deleting account setup information, will retain for future use
* Fixed an error where hidden characters would cause prior Custom Page text to not display when attempting to edit a page
* Admin panel will show Invalid Password error if store URL is correct but password is bad instead of Not Installed
* Created limited order editing to assist with order troubleshooting by technical support 

Programming
* Created widget modules for checkout page elements
* Changed uploader to watch for both ORIG_PATH_INFO and PATH_INFO for certain hosts
* Removed an unused function that would interfere with WordPress if using both software together
* Created  _xls_is_ipad(), _xls_is_iphone() and _xls_is_idevice() functions to determine these situations
* Applied proper control labels to many controls in templates, avoid default id number issues
* Updated Authorize.net has to use hash instead of mhash which was discontinued
* Added internal checks for many controls to verify control exists before attempting use, allowing controls to be deleted from templates without breaking Web Store.

# 2.1.7

* General: Corrected a Cross-Site Scripting (XSS) vulnerability to now properly handle HTML encoded strings
* General: Fixed an extremely rare issue in qCodo event handlers with certain Mac browsers
* Payments: Added additional logging of Payment error messages returned by processors

* Shipping: Improved logging of Shipping module error messages returned by calculators
* Shipping: Corrected an issue where the UPS module may truncate a Canadian postal code
* Templates: Corrected a rare product sorting error when using Sliders in custom pages
* Uploader: Corrected an issue where inventory from virtual warehouses would not be included in some calculations


# 2.1.6

* Checkout: Corrected an issue where a state/province would be displayed multiple times on checkout when using zip codes in Destinations
* Checkout: Improved state/province sorting order on checkout
* Payments: Resolved a rare issue where a PayPal check payment failure may incorrectly be applied as successful
* Uploader: Implemented new image upload error checking for LightSpeed 3.6.5


# 2.1.5

* Shipping: Resolved an issue where ZIP+4 extended Zip codes would not function in USPS or UPS modules
* Templates: Corrected an issue where Size/Color matrix was not properly showing available options
* Templates: Photos on product grid now center correctly (credit to Git User "mymacbusiness" for code change)
* Quote to Cart: Improved handling of taxes when using Quote to Cart

# 2.1.4

* Admin Panel: Improved labels for display options available through Admin Panel
* Database: Resolved a family name truncating error, field now properly stores to 255 characters

* General: Web Store now provides error message if database connection fails instead of white screen
* General: Corrected an issue where an invalid matrix combination could be chosen and error
* General: Corrected a matrix picture display issue where child photos would not refresh properly when choosing dropdown options
* General: Improved handling for certain strings not using the Web Store translator functions
* General: Corrected an error when using Contact Us with STRICT PHP settings turned on

* Mail: Improved SMTP handling to catch certain SMTP server errors on sending email
* Promo Codes: Removing a product having a product-specific promo code applied now removes code from cart properly
* Promo Codes: Resolved a rare issue where a promo code would not be removed when deleting all items in cart
* Promo Codes: Improved handling when a promo code drops cart value below a Free Shipping threshold
* Quote to Cart: Corrected an issue where LinkID was not being properly generated

* Search: Improved PHP search code to properly use framework
* Shipping: Corrected an issue with FedEx where 3-digit state/province codes would cause module to fail
* Uploader: Corrected an issue where duplicate identical Tax Codes would cause failure
* Uploader: Web Store now properly populates family table based on both the product card families field and Family setup list
* Uploader: Corrected a rare issue where Quote to Cart would use an incorrect field in pricing

* Wish List: Fixed an error where an expired Wish List could not be reactivated with a new expiry date

# 2.1.3

* General: Added missing configuration key to determine maximum products in a slider
* General: Improved state file handling to avoid large numbers of leftover state files for heavily-trafficked sites
* Checkout: Improved checks for duplicate Web Order numbers being assigned during processing
* Email: Corrected an issue where receipts would have improperly formatted date in email header
* Email: Corrected an issue where From address would not be set properly

* Payments: Promo Code now removed from a cart when a minimum cart value is no longer met by customer deleting items
* Payments: Promo Codes now properly handle family, class and web keyword filtering
* Templates: Fixed an issue where empty categories may be displayed even when set to be hidden
* Templates: Resolved an issue where Web Store would error with white page when customer logs out
* Wish List: Corrected an issue where Wish List purchases would not be marked as purchased

# 2.1.2

* Corrected an SSL error that prevented Gmail from being used as outbound SMTP
* Corrected a rare issue where the same Web Order number could be used for two orders
* Resolved an issue where pagination would generate extra blank pages on large product searches
* Corrected a rounding error using percentage discounts on Promo Codes
* Fixed an issue that prevented duplicating paginator bar

* Resolved an issue where MerchantWare Online did not allow dashes in Web Order numbers
* Improved calculation of master product inventory during product uploads
* Improved handling of subcategories in a product list
* Corrected an issue where a trailing slash in a URL would not search properly
* Corrected an issue where Product Description using bullet points would cause description to display twice

* Removed products_sliber_theme_bg misspelling from CSS files
* Improved display in Edit Cart to not display "Shipping Included Above" when shipping was not yet calculated
* Fixed an issue where an uploaded product photos of exactly 512x512 pixels may not generate thumbnail correctly
* Corrected an issue with crumbtrail display on product details
* Fixed an issue where Emailing Cart would send an incorrect link

* Resolved a rare issue where Flush Category Tree may count child products incorrectly
* Improved XML parsing to correct an issue in iUPS and USPS shipping erroring with certain countries
* Resolved an issue with the iUPS Shipping module to correct an AJAX error
* Fixed an issue where Markup was not being added to USPS shipping
* Improved handling of defined tiers where ship cost was set to zero

* Resolved an issue where a session may timeout prematurely during checkout
* Corrected an issue where Duplicate Product Code warnings were not being displayed in System Log
* Changed behavior of session state handler to use hidden fields instead of /state folder
* Fixed an issue with incorrect timestamp in the xlsws_products table
* Fixed an issue where DateTimeCreated was not correctly set in the xlsws_cart table
* Migrated ereg_replace to preg_replace in functions to conform to newer PHP standards and eliminate errors
* Corrected misdefined function calls that would generate errors when using an E_STRICT environment
* Removed closing PHP tags where no longer required (credit to Git user "JaredKazimir" for code change)


# 2.1.1

* Added troubleshooting system check for current and future upgrades
* Improved handling of States using restricted Shipping
* Improved handling of AJAX calls when using an SSL certificate
* Improved XML parsing of the iUPS Shipping module to correct an AJAX error
* Corrected an issue where a trailing slash in a URL would not search properly
* Removed products_sliber_theme_bg misspelling from CSS files
* Improved calculation of master product inventory during product uploads
* Improved handling of subcategories in a product list
* Corrected an issue with crumbtrail display on product details


# 2.1.0

### Structural
* Removed Zend Optimizer requirement, all Zend encryption on files removed
* Added Open Source license
* Web Store now works on PHP 5.3.x
* Web Store tested to work on Godaddy 4GH hosting environment, HostMonster hosting

### Payments
* Added Promo Code (Coupon Code) functionality 
* Added MerchantWARE Online to Payment Options
* Added Axia/USAePAY to Payment Options

### Shipping
* Added Tier-Shipping to Shipping Options
* Added Free Shipping to Shipping Options
* Zip validation now works consistently especially with Canadian postal codes, regex verification
* Destinations are now evaluated in correct order, specific zip ranges first, then specific states, then Any state catch-all
* Changed Restricted Shipping to only show Destionation countries based on shipping options, avoiding having to mark each country as "No" in the countries table.
* Fixed issue where turning on Tax on Shipping would incorrectly calculate with multiple tax rates set
* Changed terminology in FedEx shipping panel to match FedEx terms ("Production Password")

### Templates
* Added Advanced Search option for user product search
* Correctly use the _xt() function for translate in all templates (enables using PO files for translation)
* Fixed incorrect mouse pointer over Add To Cart on IE7 CSS
* Fixed double lines on Framework template set
* Fixed issue where the word "Available" was not displaying after inventory quantity, displaying just the number by itself when Inventory Qty Display is turned on
* Fixed misspelling in CSS element (products_sliber_theme_bg)
* Removed unused gift registry files that were duplicates 
* Fixed issue where sort order was being ignored on some search results
* Fixed issue where a failing SMTP email send would abort checkout process and fail to mark purchase as Paid
* Added error message, stop processing if template file is missing rather than simply "white screen" (missing template noted in System Log)

### Installer
* Installer now checks for all requirements and displays any fails to be corrected before allowing install
* Tested against Godaddy 4GH hosting, Hostmonster hosting
* All databases and installation files are now completely UTF8 encoded
* Image storage now defaults to File System to store photos in /photos folder
* Session storage now defaults to File System and uses /qcodo/cache/state folder

### Admin Panel
* Added On/Off option on whether to include child products in general search results
* Corrected misaligned columns on some screens
* Updated System Tasks->Upgrade Database to add new 2.1 configuration options and tables

### LightSpeed Sync
* Fixed issue where photos are properly removed 
* Apostrophes in Product Code now handled correctly 
* Reset Store properly blanks out tax tables since taxes are reuploaded in this scenario 

### Database
* Fixed issue where a large xlsws_cart table would hang attempted customer Login
* removed offensive words from Captcha word list
* Fixed issue where xlsws_cart.database_cre and datetime_due always showed year 2021 instead of correct year

### Source Code
* Many optimizations and cleanup in source code
* Added comments to all functions to describe functionality for Open Source preparation
